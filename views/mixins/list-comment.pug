include ../mixins/add-reply.pug
include ../mixins/add-comment.pug

mixin createComment(blog)
    
    if blog.comments.length > 0
        each comment in blog.comments
            .card.common-size.mx-auto.comment 
                .card-body
                    .container

                        .row  
                            .col-xs-2.col-md-2
                                div
                                    img.rounded-circle(src=(comment.user.imageUrl?`/uploads/${comment.user.imageUrl}`: `/uploads/default.png`) width="35" height="35")
                            .col-xs-2.col-md-2      
                                div.text-end
                                    small 
                                        strong.common-text-color #{comment.user.name}
                            .col-xs-6.col-md-6         
                                div.text-center
                                    small.   
                                        #{comment.message}                               
                            .col-xs-2.col-md-2        
                                    div
                                        .btn-group  
                                            
                                            .btn.btn-secondary-outline.border-0.dropdown-toggle( data-bs-toggle = "dropdown")       
                                            
                                            div.dropdown-menu(role="menu").dropdown-comment
                                                .flex.row
                                                    .d-inline-flex.justify-content-center.align-items-center
                                                        div
                                                            if isAuthenticated
                                                                if user.email == comment.user.email || isAdmin
                                                                    form(action=`/delete-comment/${comment._id}` method='POST')
                                                                        input(type="hidden" name="_csrf" value=`${csrfToken}`)
                                                                        input(type="hidden" name="blogid" value=`${blog._id}`)
                                                                        button(type='submit').btn.btn-secondary-outline.border-0
                                                                            img(src="/img/delete.png" width="10" height="10")
                                                        div
                                                            if isAuthenticated   
                                                                button(type="button" data-bs-toggle="collapse" data-bs-target=`#replyArea${comment._id}` ).btn.btn-secondary-outline.border-0
                                                                    img(src="/img/reply.png" width="13" heigth="13")
                                                        
                                                        if comment.replies.length > 0
                                                            div  
                                                                button(type="button" data-bs-toggle="collapse" data-bs-target=`#replies${comment._id}` ).btn.btn-secondary-outline.border-0
                                                                    img(src="/img/loadmore.png" width="13" heigth="13")

                        
                    .container.collapse(id=`replies${comment._id}`)            
                        if comment.replies.length > 0
                            each reply in comment.replies
                                .container
                                    .flex.row
                                        .d-flex.justify-content-around.align-items-center
                                           
                                            div 
                                                img.rounded-circle(src=(comment.user.imageUrl?`/uploads/${comment.user.imageUrl}`: `/uploads/default.png`) width="35" height="35")    
                                            
                                            div
                                                small 
                                                    strong.common-text-color #{reply.user.name}
                                           
                                            div
                                                small.
                                                    #{reply.reply} 

                                            div
                                                if isAuthenticated
                                                    if user.email == reply.user.email || isAdmin
                                                        form(action=`/delete-reply/${reply._id}` method='POST')
                                                            input(type="hidden" name="_csrf" value=`${csrfToken}`)
                                                            input(type="hidden" name="blogid" value=`${blog._id}`)
                                                            button(type='submit').btn.btn-secondary-outline.border-0
                                                                img(src="/img/delete.png" width="10" height="10")
                    .container.collapse(id=`replyArea${comment._id}`)    
                        .container    
                            +replyArea(blog, comment)    
            .container.for-spacing               
    else 
        
    if isAuthenticated
        +commentArea(blog)
    else 
        .container.for-spacing

        .container.common-size.mx-auto
            .alert.alert-warning.text-center Yorum yapmak için lütfen giriş yapınız.
    
            